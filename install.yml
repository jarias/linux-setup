# Copyright 2015 Julio Arias
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
# Here we describe every software we may want to install
- hosts: all
  tasks:
    # Repos
    # Intel
    - name: Install Intel repo key
      apt_key: url=https://download.01.org/gfx/RPM-GPG-KEY-ilg state=present
      sudo: True
    - name: Install Intel repo key2
      apt_key: url=https://download.01.org/gfx/RPM-GPG-KEY-ilg-2 state=present
      sudo: True
    - name: Install Intel repo
      apt_repository: repo='deb https://download.01.org/gfx/ubuntu/15.10/main wily main' state=present
      sudo: True

    # I3
    - name: Install i3 repo
      apt_repository: repo='deb http://debian.sur5r.net/i3/ wily universe' state=present
      sudo: True

    - name: Install i3 repo keyring
      apt: name=sur5r-keyring force=yes
      sudo: True

    # fontconfig-infinality
    - name: Install no1wantdthisname/ppa repo key
      apt_key: keyserver=keyserver.ubuntu.com id=66BA314CE985B27B state=present
      sudo: True
    - name: Install fontconfig-infinality repo
      apt_repository: repo='deb http://ppa.launchpad.net/no1wantdthisname/ppa/ubuntu wily main' state=present
      sudo: True
    - name: Install openjdk-fontfix repo
      apt_repository: repo='deb http://ppa.launchpad.net/no1wantdthisname/openjdk-fontfix/ubuntu wily main ' state=present
      sudo: True

    # HipChat
    - name: Install HipChat repo key
      apt_key: url=https://www.hipchat.com/keys/hipchat-linux.key state=present
      sudo: True
    - name: Install HipChat repo
      apt_repository: repo='deb http://downloads.hipchat.com/linux/apt stable main' state=present
      sudo: True

    # NodeJS
    - name: Install NodeJS repo key
      apt_key: url=https://deb.nodesource.com/gpgkey/nodesource.gpg.key state=present
      sudo: True
    - name: Install NodeJS repo
      apt_repository: repo='deb https://deb.nodesource.com/node_4.x wily main' state=present
      sudo: True

    # Heroku Toolbelt
    - name: Install Heroku Toolbelt repo key
      apt_key: url=https://toolbelt.heroku.com/apt/release.key state=present
      sudo: True
    - name: Install Heroku Toolbelt repo
      apt_repository: repo='deb http://toolbelt.heroku.com/ubuntu ./' state=present
      sudo: True

    # Syncthing
    - name: Install Syncthing repo key
      apt_key: url=https://syncthing.net/release-key.txt state=present
      sudo: True
    - name: Install Syncthing repo
      apt_repository: repo='deb http://apt.syncthing.net/ syncthing release' state=present
      sudo: True

    # Numix
    - name: Install Numix repo
      apt_repository: repo='ppa:numix/ppa'
      sudo: True

    # Moka
    - name: Install Moka repo
      apt_repository: repo='ppa:moka/stable'
      sudo: True

    # LibreOffice
    - name: Install LibreOffice repo
      apt_repository: repo='ppa:libreoffice/ppa'
      sudo: True

    - name: Dist upgrade
      apt: upgrade=dist
      sudo: True

    # Base packages
    - name: Install base system packages
      apt: name={{ item }} state=latest install_recommends=no
      sudo: True
      with_items:
        - subversion
        - bzr
        - openjdk-8-jdk
        - tmux
        - build-essential
        - cloc
        - exuberant-ctags
        - heroku-toolbelt
        - tmux
        - python
        - python-dev
        - python-setuptools
        - zsh
        - git
        - git-flow
        - mercurial
        - syncthing
        - curl
        - ruby
        - ruby-dev
        - vim
        - libgecode-dev
        - unzip
        - libpq-dev
        - libevent-dev
        - vlc
        - openvpn
        - numix-gtk-theme
        - numix-icon-theme-circle
        - moka-icon-theme
        - openssh-server
        - libreoffice
        - libnss3-tools
        - hipchat
        - autoconf
        - automake
        - pkg-config
        - libgtk-3-dev
        - graphviz
        - keychain
        - fontconfig-infinality
        - nodejs
        - xorg
        - xserver-xorg-video-intel
        - lightdm
        - lightdm-gtk-greeter
        - i3
        - i3blocks
        - p7zip-full
        - xz-utils
        - terminator
        - lxappearance
        - compton
        - intel-linux-graphics-installer
        - thunar
        - imagemagick

    - name: Install Python pip
      easy_install: name=pip
      sudo: True

    # Gems
    - name: Install default Ruby Gems
      gem: name={{ item }} state=present user_install=no
      sudo: True
      with_items:
        - bundler
        - homesick
        - git-smart
        - berkshelf
        - pry
        - hirb
        - svn2git
        - ghost
        - lolcat

    # NPM
    - name: Setup NPM prefix
      command: /usr/bin/npm config set prefix '~/.npm-packages'
               creates=~/.npmrc
    - name: Install NPM default packages
      npm: name={{ item }} global=yes
      with_items:
        - grunt-cli
        - bower
        - yo
        - ember-cli
        - broccoli-cli
        - jshint
        - sslmate

    # Python pip
    - name: Install Python pip default packages
      pip: name={{ item }} extra_args='--user'
      with_items:
        - awscli
        - psutil
        - powerline-status
        - docker-compose
        - pgcli
        - mycli

    # Docker
    - name: Install Docker
      shell: curl -sSL https://get.docker.com/ | sh
             creates=/usr/bin/docker
      sudo: True

    - name: Create downloads directory
      file: path=/usr/local/downloads state=directory
      sudo: True

    # Go
    - name: Download Go
      get_url: url=https://storage.googleapis.com/golang/go1.5.linux-amd64.tar.gz
               dest=/usr/local/downloads/go1.5.linux-amd64.tar.gz
      sudo: True

    - name: Unarchive Go
      unarchive: src=/usr/local/downloads/go1.5.linux-amd64.tar.gz
                 dest=/usr/local/
                 creates=/usr/local/bin/go
                 copy=no
      sudo: True

    - name: Link Go binaries to /usr/local/bin/
      file: src=/usr/local/go/bin/{{ item }} dest=/usr/local/bin/{{ item }} state=link
      sudo: True
      with_items:
        - go
        - godoc
        - gofmt

    - name: Create GOPATH dir
      file: state=directory path="~/Golang"
    - name: Install default Go packages
      shell: GOPATH=~/Golang go get {{ item.package }}
      with_items:
        - { package: github.com/tools/godep }
        - { package: golang.org/x/tools/cmd/gotype }
        - { package: golang.org/x/tools/cmd/goimports }
        - { package: golang.org/x/tools/cmd/cover }
        - { package: github.com/onsi/ginkgo/ginkgo }
        - { package: github.com/onsi/gomega }
        - { package: github.com/golang/lint/golint }
        - { package: github.com/constabulary/gb/... }

    # Arc Theme
    - name: Clone Arc Theme repo
      git: repo="https://github.com/horst3180/arc-theme" depth=1 dest=/usr/local/src/arc-theme
      sudo: True
    - name: Configure Arc Theme
      command: ./autogen.sh --prefix=/usr chdir=/usr/local/src/arc-theme
      sudo: True
    - name: Install Arc Theme
      command: make install chdir=/usr/local/src/arc-theme
      sudo: True

    # Direnv
    - name: Download direnv
      git: repo=https://github.com/direnv/direnv.git dest=/usr/local/downloads/direnv
      sudo: True
    - name: Install direnv
      command: make install chdir=/usr/local/downloads/direnv creates=/usr/local/bin/direnv
      sudo: True

    # Maven
    - name: Download Maven
      get_url: url=http://mirrors.ucr.ac.cr/apache/maven/maven-3/3.3.1/binaries/apache-maven-3.3.1-bin.tar.gz
               dest=/usr/local/downloads/apache-maven-3.3.1-bin.tar.gz
      sudo: True
    - name: Unarchive Maven
      unarchive: src=/usr/local/downloads/apache-maven-3.3.1-bin.tar.gz
                 dest=/usr/local/
                 creates=/usr/local/apache-maven-3.3.1
                 copy=no
      sudo: True
    - name: Link Maven binaries in /usr/local/bin/
      file: src=/usr/local/apache-maven-3.3.1/bin/{{ item }} dest=/usr/local/bin/{{ item }} state=link
      sudo: True
      with_items:
        - mvn
        - mvnDebug

    # Gradle
    - name: Download Gradle
      get_url: url=https://downloads.gradle.org/distributions/gradle-2.6-all.zip
               dest=/usr/local/downloads/gradle-2.6-all.zip
      sudo: True
    - name: Unarchive Gradle
      unarchive: src=/usr/local/downloads/gradle-2.6-all.zip
                 dest=/usr/local/
                 creates=/usr/local/gradle-2.6
                 copy=no
      sudo: True
    - name: Link Gradle binaries in /usr/local/bin/
      file: src=/usr/local/gradle-2.6/bin/{{ item }} dest=/usr/local/bin/{{ item }} state=link
      sudo: True
      with_items:
        - gradle

    # Virtualbox
    - name: Download Virtualbox deb package
      get_url: url=http://download.virtualbox.org/virtualbox/5.0.10/virtualbox-5.0_5.0.10-104061~Ubuntu~wily_amd64.deb
               dest=/usr/local/downloads/virtualbox-5.0_5.0.10-104061~Ubuntu~wily_amd64.deb
      sudo: True
    - name: Install Virtualbox
      apt: deb=/usr/local/downloads/virtualbox-5.0_5.0.10-104061~Ubuntu~wily_amd64.deb
      sudo: True

    # Vagrant
    - name: Download Vagrant deb package
      get_url: url=https://dl.bintray.com/mitchellh/vagrant/vagrant_1.7.4_x86_64.deb
               dest=/usr/local/downloads/vagrant_1.7.4_x86_64.deb
      sudo: True
    - name: Install Vagrant
      apt: deb=/usr/local/downloads/vagrant_1.7.4_x86_64.deb
      sudo: True

    # Packer
    - name: Download Packer
      get_url: url=https://dl.bintray.com/mitchellh/packer/packer_0.8.5_linux_amd64.zip
               dest=/usr/local/downloads/packer_0.8.5_linux_amd64.zip
      sudo: True
    - name: Install Packer
      unarchive: src=/usr/local/downloads/packer_0.8.5_linux_amd64.zip
                 dest=/usr/local/bin
                 creates=/usr/local/bin/packer
                 copy=no
      sudo: True

    # Terraform
    - name: Download Terraform
      get_url: url=https://dl.bintray.com/mitchellh/terraform/terraform_0.6.3_linux_amd64.zip
               dest=/usr/local/downloads/terraform_0.6.3_linux_amd64.zip
      sudo: True
    - name: Install Terraform
      unarchive: src=/usr/local/downloads/terraform_0.6.3_linux_amd64.zip
                 dest=/usr/local/bin
                 creates=/usr/local/bin/terraform
                 copy=no
      sudo: True

    # Etcd
    - name: Download Etcd
      get_url: url=https://github.com/coreos/etcd/releases/download/v2.1.2/etcd-v2.1.2-linux-amd64.tar.gz
               dest=/usr/local/downloads/etcd-v2.1.2-linux-amd64.tar.gz
      sudo: True
    - name: Unarchive Etcd
      unarchive: src=/usr/local/downloads/etcd-v2.1.2-linux-amd64.tar.gz
                 dest=/usr/local/
                 creates=/usr/local/etcd-v2.1.2-linux-amd64
                 copy=no
      sudo: True
    - name: Link Etcd binaries in /usr/local/bin/
      file: src=/usr/local/etcd-v2.1.2-linux-amd64/{{ item }} dest=/usr/local/bin/{{ item }} state=link
      sudo: True
      with_items:
        - etcdctl

    # Fleet
    - name: Download Fleet
      get_url: url=https://github.com/coreos/fleet/releases/download/v0.11.5/fleet-v0.11.5-linux-amd64.tar.gz
               dest=/usr/local/downloads/fleet-v0.11.5-linux-amd64.tar.gz
      sudo: True
    - name: Unarchive Fleet
      unarchive: src=/usr/local/downloads/fleet-v0.11.5-linux-amd64.tar.gz
                 dest=/usr/local/
                 creates=/usr/local/fleet-v0.11.5-linux-amd64
                 copy=no
      sudo: True
    - name: Link Fleet binaries in /usr/local/bin/
      file: src=/usr/local/fleet-v0.11.5-linux-amd64/{{ item }} dest=/usr/local/bin/{{ item }} state=link
      sudo: True
      with_items:
        - fleetctl

    # Ngrok
    - name: Download Ngrok
      get_url: url=https://dl.ngrok.com/ngrok_2.0.19_linux_amd64.zip
               dest=/usr/local/downloads/ngrok_2.0.19_linux_amd64.zip
      sudo: True
    - name: Install Ngrok
      unarchive: src=/usr/local/downloads/ngrok_2.0.19_linux_amd64.zip
                 dest=/usr/local/bin
                 creates=/usr/local/bin/ngrok
                 copy=no
      sudo: True

    # IntelliJ IDEA
    - name: Download IntelliJ
      get_url: url=https://download.jetbrains.com/idea/ideaIU-15.0.1.tar.gz
               dest=/usr/local/downloads/ideaIU-15.0.1.tar.gz
      sudo: True
    - name: Unarchive IntelliJ
      unarchive: src=/usr/local/downloads/ideaIU-15.0.1.tar.gz
                 dest=/usr/local
                 creates=/usr/local/idea-IU-143.382.35
                 copy=no
      sudo: True
    - name: Link IntelliJ binaries to /usr/local/bin
      file: src=/usr/local/idea-IU-143.382.35/bin/{{ item }} dest=/usr/local/bin/{{ item }} state=link force=yes
      sudo: True
      with_items:
        - idea.sh

    # Sublime Text 3
    - name: Download Sublime Text 3
      get_url: url=http://c758482.r82.cf2.rackcdn.com/sublime-text_build-3083_amd64.deb
               dest=/usr/local/downloads/sublime-text_build-3083_amd64.deb
      sudo: True
    - name: Install Sublime Text 3
      apt: deb=/usr/local/downloads/sublime-text_build-3083_amd64.deb
      sudo: True

    # Skype
    - name: Download Skype
      get_url: url=http://download.skype.com/linux/skype-ubuntu-precise_4.3.0.37-1_i386.deb
               dest=/usr/local/downloads/skype-ubuntu-precise_4.3.0.37-1_i386.deb
      sudo: True
    - name: Install Skype
      apt: deb=/usr/local/downloads/skype-ubuntu-precise_4.3.0.37-1_i386.deb
      sudo: True

    # Atom
    - name: Download Atom
      get_url: url=https://github.com/atom/atom/releases/download/v1.2.3/atom-amd64.deb
               dest=/usr/local/downloads/atom-amd64.deb
      sudo: True
    - name: Install Atom
      apt: deb=/usr/local/downloads/atom-amd64.deb
      sudo: True

    # Arduino IDE
    - name: Download Arduino IDE
      get_url: url=http://downloads.arduino.cc/arduino-1.6.5-linux64.tar.xz
               dest=/usr/local/downloads/arduino-1.6.5-linux64.tar.xz
      sudo: True
    - name: Install Arduino IDE
      unarchive: src=/usr/local/downloads/arduino-1.6.5-linux64.tar.xz
                 dest=/usr/local
                 creates=/usr/local/arduino-1.6.5
                 copy=no
      sudo: True
    - name: Link Arduino IDE binaries to /usr/local/bin
      file: src=/usr/local/arduino-1.6.5/{{ item }} dest=/usr/local/bin/{{ item }} state=link
      sudo: True
      with_items:
        - arduino

    # Google Chrome
    - name: Download Google Chrome
      get_url: url=https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
               dest=/usr/local/downloads/google-chrome-stable_current_amd64.deb
      sudo: True
    - name: Install Google Chrome
      apt: deb=/usr/local/downloads/google-chrome-stable_current_amd64.deb
      sudo: True
      ignore_errors: yes

    # Dropbox
    - name: Download Dropbox
      get_url: url='https://www.dropbox.com/download?dl=packages/ubuntu/dropbox_2015.10.28_amd64.deb'
               dest=/usr/local/downloads/dropbox_2015.10.28_amd64.deb
      sudo: True
    - name: Install Dropbox
      apt: deb=/usr/local/downloads/dropbox_2015.10.28_amd64.deb
      sudo: True

    # Heroku plugins
    - name: Install Heroku plugins
      command: heroku plugins:install {{ item }}
      with_items:
        - https://github.com/ddollar/heroku-accounts.git
        - https://github.com/heroku/heroku-pg-extras.git
        - https://github.com/ddollar/heroku-pg-transfer.git

    # Vagrant plugins
    - name: Install Vagrant plugins
      command: vagrant plugin install {{ item }}
      with_items:
        - vagrant-vbguest

    # Fonts
    - name: Clone powerline fonts repo
      git: repo=https://github.com/powerline/fonts dest=/usr/local/downloads/powerline-fonts
      sudo: True
    - name: Install powerline fonts
      command: /usr/local/downloads/powerline-fonts/install.sh chdir=/usr/local/downloads/powerline-fonts

    - name: Download source code pro fonts
      get_url: url=https://github.com/adobe-fonts/source-code-pro/archive/2.010R-ro/1.030R-it.tar.gz
               dest=/usr/local/downloads/1.030R-it.tar.gz
      sudo: True
    - name: Unarchive source code pro fonts
      unarchive: src=/usr/local/downloads/1.030R-it.tar.gz
                 dest=/usr/local/downloads
                 creates=/usr/local/downloads/source-code-pro-2.010R-ro-1.030R-it
                 copy=no
      sudo: True
    - name: Install source code pro fonts
      synchronize: src=/usr/local/downloads/source-code-pro-2.010R-ro-1.030R-it/OTF/ dest=~/.fonts/

    - name: Download System San Francisco font
      get_url: url=https://github.com/supermarin/YosemiteSanFranciscoFont/archive/master.zip
               dest=/usr/local/downloads/ssf.zip
      sudo: True
    - name: Unarchive System San Francisco font
      unarchive: src=/usr/local/downloads/ssf.zip
                 dest=/usr/local/downloads
                 creates=/usr/local/downloads/YosemiteSanFranciscoFont-master
                 copy=no
      sudo: True
    - name: Install System San Francisco font
      copy: src='/usr/local/downloads/YosemiteSanFranciscoFont-master/{{ item }}.ttf' dest=~/.fonts
      with_items:
        - System San Francisco Display Regular
        - System San Francisco Display Thin
        - System San Francisco Display Ultralight
        - System San Francisco Display Bold

    - name: Download Font-Awesome
      get_url: url=https://github.com/FortAwesome/Font-Awesome/archive/v4.4.0.tar.gz
               dest=/usr/local/downloads/FontAwesome.tar.gz
      sudo: True
    - name: Unarchive Font-Awesome
      unarchive: src=/usr/local/downloads/FontAwesome.tar.gz
                 dest=/usr/local/downloads
                 creates=/usr/local/downloads/Font-Awesome-4.4.0
                 copy=no
      sudo: True
    - name: Install Font-Awesome
      copy: src=/usr/local/downloads/Font-Awesome-4.4.0/fonts/fontawesome-webfont.ttf dest=~/.fonts

    - name: Update font cache
      command: fc-cache -f -v
      sudo: True

    # Vim plugins
    - name: Create bundle directory
      file: path=~/.vim/bundle state=directory recurse=true

    - name: Create autoload directory
      file: path=~/.vim/autoload state=directory recurse=true

    - name: Install Pathogen
      get_url: url=https://raw.github.com/tpope/vim-pathogen/master/autoload/pathogen.vim
               dest=~/.vim/autoload/pathogen.vim

    - name: Install Vim plugins
      git: repo={{ item.repo }} dest=~/.vim/bundle/{{ item.name }}
      with_items:
        - { repo: 'https://github.com/Shougo/neocomplete.vim', name: 'neocomplete.tool' }
        - { repo: 'https://github.com/mileszs/ack.vim.git', name: 'ack.tool' }
        - { repo: 'https://github.com/vim-scripts/molokai.git', name: 'molokai.color' }
        - { repo: 'https://github.com/scrooloose/nerdtree.git', name: 'nerdtree.tool' }
        - { repo: 'https://github.com/jeetsukumaran/vim-buffergator.git', name: 'buffergator.tool' }
        - { repo: 'https://github.com/tpope/vim-fugitive.git', name: 'fugitive.tool' }
        - { repo: 'https://github.com/fatih/vim-go.git', name: 'go.lang' }
        - { repo: 'https://github.com/pangloss/vim-javascript.git', name: 'javascript.lang' }
        - { repo: 'https://github.com/mmalecki/vim-node.js.git', name: 'nodejs.lang' }
        - { repo: 'https://github.com/kien/ctrlp.vim.git', name: 'ctrlp.tool' }
        - { repo: 'https://github.com/scrooloose/nerdcommenter.git', name: 'nerdcommenter.tool' }
        - { repo: 'https://github.com/ervandew/supertab.git', name: 'supertab.tool' }
        - { repo: 'https://github.com/Lokaltog/vim-easymotion.git', name: 'easymotion.tool' }
        - { repo: 'https://github.com/tpope/vim-git.git', name: 'git.lang' }
        - { repo: 'https://github.com/tfnico/vim-gradle.git', name: 'gradle.lang' }
        - { repo: 'https://github.com/groenewege/vim-less.git', name: 'less.lang' }
        - { repo: 'https://github.com/bronson/vim-trailing-whitespace.git', name: 'trailing-whitespace.tool' }
        - { repo: 'https://github.com/terryma/vim-multiple-cursors.git', name: 'multiple-cursors.tool' }
        - { repo: 'https://github.com/scrooloose/syntastic.git', name: 'syntastic.tool' }
        - { repo: 'https://github.com/maksimr/vim-jsbeautify.git', name: 'jsbeautify.tool' }
        - { repo: 'https://github.com/tpope/vim-sensible.git', name: 'vim-sensible.config' }
        - { repo: 'https://github.com/majutsushi/tagbar.git', name: 'tagbar.tool' }
        - { repo: 'https://github.com/vim-scripts/ZoomWin.git', name: 'ZoomWin.tool' }
